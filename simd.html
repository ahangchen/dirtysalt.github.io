<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>SIMD</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="dirtysalt" />
<link rel="shortcut icon" href="http://dirtysalt.info/css/favicon.ico" />
<link rel="stylesheet" type="text/css" href="./css/site.css" />
</head>
<body>
<div id="content">
<h1 class="title">SIMD</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline8">1. 指令集</a>
<ul>
<li><a href="#orgheadline1">1.1. MMX</a></li>
<li><a href="#orgheadline2">1.2. SSE.</a></li>
<li><a href="#orgheadline3">1.3. SSE2</a></li>
<li><a href="#orgheadline4">1.4. SSE3</a></li>
<li><a href="#orgheadline5">1.5. SSSE3</a></li>
<li><a href="#orgheadline6">1.6. SSE4</a></li>
<li><a href="#orgheadline7">1.7. 检测代码</a></li>
</ul>
</li>
<li><a href="#orgheadline20">2. 基本概念</a>
<ul>
<li><a href="#orgheadline9">2.1. %mm寄存器</a></li>
<li><a href="#orgheadline10">2.2. %xmm寄存器</a></li>
<li><a href="#orgheadline11">2.3. %mxcsr寄存器</a></li>
<li><a href="#orgheadline12">2.4. Saturation &amp; Wraparound</a></li>
<li><a href="#orgheadline13">2.5. General Purpose Register(GPR)</a></li>
<li><a href="#orgheadline14">2.6. X87 FPU</a></li>
<li><a href="#orgheadline15">2.7. Packed &amp; Scalar Instructions</a></li>
<li><a href="#orgheadline16">2.8. Temporal &amp; NonTemporal Data</a></li>
<li><a href="#orgheadline17">2.9. Alignment</a></li>
<li><a href="#orgheadline18">2.10. Asymmetric &amp; Horizontal Processing</a></li>
<li><a href="#orgheadline19">2.11. Zero Fill &amp; Truncated</a></li>
</ul>
</li>
<li><a href="#orgheadline56">3. 指令</a>
<ul>
<li><a href="#orgheadline27">3.1. Data Transfer Instructions</a>
<ul>
<li><a href="#orgheadline21">3.1.1. Move Mask Instructions</a></li>
<li><a href="#orgheadline22">3.1.2. Move Integer Instructions</a></li>
<li><a href="#orgheadline23">3.1.3. Move Float Instructions</a></li>
<li><a href="#orgheadline24">3.1.4. Move Double Instructions</a></li>
<li><a href="#orgheadline25">3.1.5. Move Duplication Instructions</a></li>
<li><a href="#orgheadline26">3.1.6. Move NonTemporal Instructions</a></li>
</ul>
</li>
<li><a href="#orgheadline40">3.2. Arithmetic Instructions</a>
<ul>
<li><a href="#orgheadline30">3.2.1. ADD Instructions</a></li>
<li><a href="#orgheadline33">3.2.2. SUB Instructions</a></li>
<li><a href="#orgheadline34">3.2.3. MUL Instructions</a></li>
<li><a href="#orgheadline35">3.2.4. DIV Instructions</a></li>
<li><a href="#orgheadline38">3.2.5. M?X Instructions</a></li>
<li><a href="#orgheadline39">3.2.6. Math Instructions</a></li>
</ul>
</li>
<li><a href="#orgheadline41">3.3. Comparison Instructions</a></li>
<li><a href="#orgheadline42">3.4. Conversion Instructions</a></li>
<li><a href="#orgheadline43">3.5. Insert &amp; Unpack Instructions</a></li>
<li><a href="#orgheadline44">3.6. Logical Instructions</a></li>
<li><a href="#orgheadline45">3.7. Shift Instructions</a></li>
<li><a href="#orgheadline46">3.8. Shuffle Instructions</a></li>
<li><a href="#orgheadline47">3.9. Blending Instructions</a></li>
<li><a href="#orgheadline48">3.10. String Instructions</a></li>
<li><a href="#orgheadline55">3.11. MISC Instructions</a>
<ul>
<li><a href="#orgheadline49">3.11.1. Cache Control Instructions</a></li>
<li><a href="#orgheadline50">3.11.2. Prefetch Instructions</a></li>
<li><a href="#orgheadline51">3.11.3. Memory Ordering Instructions</a></li>
<li><a href="#orgheadline52">3.11.4. X87 FPU Instructions</a></li>
<li><a href="#orgheadline53">3.11.5. Thread Sync Instructions</a></li>
<li><a href="#orgheadline54">3.11.6. 其他</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
从Pentium II和Pentium MMX处理器系列开始,芯片开始支持SIMD操作.
SIMD全称是Single Instruction Multiple Data,即单指令多数据,
可以在一个周期内操作多个数据.
</p>

<div id="outline-container-orgheadline8" class="outline-2">
<h2 id="orgheadline8"><span class="section-number-2">1</span> 指令集</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> MMX</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>Multimedia Extensions.[PII &amp; PMMX]</li>
<li>(CPUID.01H:EDX.MMX[bit 23]=1)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">1.2</span> SSE.</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>Streaming SIMD Extensions.[PIII]</li>
<li>(CPUID.01H:EDX.SSE[bit 25]=1)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">1.3</span> SSE2</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>Streaming SIMD Extensions2.[P4 &amp; Xeon]</li>
<li>(CPUID.01H:EDX.SSE2[bit 26]=1)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">1.4</span> SSE3</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>Streaming SIMD Extensions3.[P4(HT)]</li>
<li>(CPUID.01H:ECX.SSE3[bit 0]=1)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">1.5</span> SSSE3</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>Supplemental Stream SIMD Extensions3.[Xeon(5100) &amp; Core2]</li>
<li>(CPUID.01H:ECX.SSSE3[bit 9]=1)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">1.6</span> SSE4</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li>Streaming SIMD Extensions4.[Xeon(5400) &amp; Core2Ex(QX9650)]</li>
<li>SSE4.1.(CPUID.01H:ECX.SSE4_1[bit 19]=1)</li>
<li>SSE4.2.(CPUID.01H:ECX.SSE4_2[bit 20]=1)</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">1.7</span> 检测代码</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">

<pre class="src src-C++"><span class="org-comment-delimiter">/***************************************************************************</span>
<span class="org-comment"> *</span>
<span class="org-comment"> * Copyright (c) Baidu.com, Inc. All Rights Reserved</span>
<span class="org-comment"> *</span>
<span class="org-comment"> **************************************************************************/</span>


<span class="org-comment-delimiter">/**</span>
<span class="org-comment"> * @file   detect.c</span>
<span class="org-comment"> * @author zhangyan04(@baidu.com)</span>
<span class="org-comment"> * @brief</span>
<span class="org-comment"> *</span>
<span class="org-comment"> */</span>

<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-type">int</span> <span class="org-function-name">check_support_mmx</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x800000,%%edx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">check_support_sse</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x02000000,%%edx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">check_support_sse2</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x04000000,%%edx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">check_support_sse3</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x1,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">check_support_ssse3</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x0200,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">check_support_sse4_1</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x80000,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">check_support_sse4_2</span>(){
    <span class="org-type">int</span> <span class="org-variable-name">res</span>=0;
    <span class="org-keyword">__asm__</span> __volatile__(
        <span class="org-string">"movl $1,%%eax\n\t"</span>
        <span class="org-string">"cpuid\n\t"</span>
        <span class="org-string">"test $0x0100000,%%ecx\n\t"</span>
        <span class="org-string">"jz 1f\n\t"</span>
        <span class="org-string">"movl $1,%0\n\t"</span>
        <span class="org-string">"1:\n\t"</span>
        :<span class="org-string">"=m"</span>(res)
        ::<span class="org-string">"eax"</span>,<span class="org-string">"edx"</span>);
    <span class="org-keyword">return</span> res;
}
<span class="org-type">int</span> <span class="org-function-name">main</span>(){
    printf(<span class="org-string">"MMX[%s]\n"</span>,check_support_mmx()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE[%s]\n"</span>,check_support_sse()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE2[%s]\n"</span>,check_support_sse2()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE3[%s]\n"</span>,check_support_sse3()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSSE3[%s]\n"</span>,check_support_ssse3()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE4.1[%s]\n"</span>,check_support_sse4_1()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    printf(<span class="org-string">"SSE4.2[%s]\n"</span>,check_support_sse4_2()?<span class="org-string">"OK"</span>:<span class="org-string">"FAILED"</span>);
    <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-2">
<h2 id="orgheadline20"><span class="section-number-2">2</span> 基本概念</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"><span class="section-number-3">2.1</span> %mm寄存器</h3>
<div class="outline-text-3" id="text-2-1">
<p>
%mm寄存器是64bit,共有8个%mm寄存器.需要注意的是,%mm0-%mm7是X87 FPU寄存器的alias,
分别对应%r0-%r7.所以对%mm0-%mm7的操作会覆盖X87 FPU的内容.使用%mm寄存器的时候,
效果是这样的.
</p>
<ol class="org-ol">
<li>TOS(Top Of Stack)会被置为0,也就是FPU registers的顶部会置0.</li>
<li>整个FPU tag word会被置为valid(0x0).如果后续想使用的话,需要使用EMMS指令.</li>
<li>FPU register有80位,但是%mm寄存器只是用了64位,因此其余位填充(0xff).</li>
</ol>

<p>
因此如果在使用%mm寄存器之后,想使用FPU指令的话,那么应该
</p>
<ol class="org-ol">
<li>fsave/fxsave保存FPU状态.</li>
<li>执行EMMS指令.</li>
<li>可选地使用frstore/fxstore载入之前FPU状态.</li>
<li>执行FPU指令.</li>
</ol>

<p>
如果使用FPU指令之后,想切换回%mm寄存器的话.
</p>
<ol class="org-ol">
<li>fsave/fxsave保存FPU状态.</li>
<li>可选地使用frstore/fxrstore载入之前FPU状态.</li>
<li>操作%mm寄存器.</li>
</ol>

<p>
EMMS指令会清除MMX的状态,将FPU tag word进行清空,表示所有的FPU registers都已经清空.
我们必须在执行完成MMX指令之后,如果之后需要使用FPU registers的话,那么需要执行这个指令.
</p>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">2.2</span> %xmm寄存器</h3>
<div class="outline-text-3" id="text-2-2">
<p>
%xmm寄存器是128bit.
Intel64架构下允许访问16个%xmm寄存器.
IA-32架构下只允许访问8个%xmm寄存器.
</p>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"><span class="section-number-3">2.3</span> %mxcsr寄存器</h3>
<div class="outline-text-3" id="text-2-3">
<p>
%mxcsr是32bit.%mxcsr寄存器是在SSE指令集引入的,用来控制作用在%xmm寄存器操作的行为,
所有的这些行为都是和浮点相关的,在某种程度上非常类似于X87 FPU tag word.
关于%mxcsr寄存器各个位所表示的意思在这里不细说,可以查看Intel手册得到详细解释.
可以查看Intel Vol.1 10.2.3.%mxcrs默认值是0x1f80.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">LDMXCSR</td>
<td class="org-left">mem-&gt;%mxcsr.32bit</td>
</tr>

<tr>
<td class="org-left">STMXCSR</td>
<td class="org-left">%mxcsr-&gt;mem.32bit</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="section-number-3">2.4</span> Saturation &amp; Wraparound</h3>
<div class="outline-text-3" id="text-2-4">
<p>
在进行整数运算的时候,可能会存在out-of-range的情况,结果不能够被目标数所表示.对于
这种溢出处理有下面3种方式.
</p>
<ul class="org-ul">
<li>Wraparound Arithmetic.</li>
</ul>
<p>
回绕模式.比如8个字节表示257的话,那么就是257-256=1.
</p>
<ul class="org-ul">
<li>Signed Saturation Arithmetic.</li>
</ul>
<p>
符号位溢出模式.比如8个字节表示257的话,那么会是0x7f=127.
</p>
<ul class="org-ul">
<li>Unsigned Saturation Arithmetic.</li>
</ul>
<p>
无符号溢出模式.比如8个字节表示257的话,那么会是0xff=255.
</p>

<p>
对于溢出模式对于一些计算是非常重要的.假设256色的像素如果两个像素相叠加的话,
当然不希望像素值发生回绕.如果溢出的话,通常这个像素保持纯黑或者是纯白.
</p>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">2.5</span> General Purpose Register(GPR)</h3>
<div class="outline-text-3" id="text-2-5">
<p>
通用寄存器,包括EAX/RAX,EBX/RBX,ECX/RCX等.这些通用寄存器和%mm和%xmm之间的差别是,
%mm和%xmm不能够用来存放地址,也就是说不能够将内存地址存放在%mm和%xmm里面然后进行引用.
</p>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">2.6</span> X87 FPU</h3>
<div class="outline-text-3" id="text-2-6">
<p>
X87 FPU是浮点运算部件,共有8个寄存器,组织方式是堆栈.通常来说对于SIMD并不需要关心
X87 FPU这个部件.但是因为SIMD使用的%mm寄存器是FPU寄存器的alias,所以我们这里需要了解.
后面我们把X87 FPU都称为FPU.
</p>

<p>
对于FPU会有一个状态,状态包括执行环境和寄存器内容.每个寄存器80bit.在操作%mm寄存器
和执行FPU指令切换之间,我们可能需要保存状态.那么下面就是关于FPU操作状态的指令.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">FSAVE</td>
<td class="org-left">保存FPU状态,然后重新初始化FPU.84/108字节</td>
</tr>

<tr>
<td class="org-left">FRSTORE</td>
<td class="org-left">FSAVE逆操作.</td>
</tr>

<tr>
<td class="org-left">FXSAVE</td>
<td class="org-left">保存FPU状态/%mm寄存器,%xmm寄存器,%mxscr寄存器.512字节.</td>
</tr>

<tr>
<td class="org-left">FXRSTORE</td>
<td class="org-left">FXSAVE逆操作.</td>
</tr>
</tbody>
</table>

<p>
关于如何协调%mm寄存器和FPU寄存器的使用,在%mm寄存器这节有解释.
</p>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">2.7</span> Packed &amp; Scalar Instructions</h3>
<div class="outline-text-3" id="text-2-7">
<p>
对于SIMD提供了操作packed和scalar指令.我们假设存在两个操作数,
假设是(f00,f01,f02,f03)和(f10,f11,f12,f13)的话,那么
</p>
<ul class="org-ul">
<li>如果是packed操作的话,那么操作是(f00 op f01,f01 op f11,f02 op f12,f03 op f13).</li>
<li>如果是scalar操作的话,那么操作是(f00,f01,f03,f03 op f13).</li>
</ul>
<p>
也就是说,如果在scalar操作的话,仅仅是操作最后面一个单元,其他单元全部复制.
</p>

<p>
需要注意的是,在Scalar操作下面
</p>
<ul class="org-ul">
<li>单精度浮点是24-bit significand + 8-bit exponent.</li>
<li>双精度浮点是53-bit significand + 11-bit exponent.</li>
</ul>
<p>
而在IEEE-754和FPU操作环境下面的的话
</p>
<ul class="org-ul">
<li>单精度浮点是24-bit significand + 15-bit exponent.</li>
<li>双精度浮点是52-bit significand + 15-bit exponent.</li>
</ul>
<p>
此外SIMD操作浮点数和FPU操作浮点数有些不同,SIMD是直接操作浮点数的Native Format,
而FPU是首先在更高的精度上面操作,然后取舍到Native Format.
</p>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">2.8</span> Temporal &amp; NonTemporal Data</h3>
<div class="outline-text-3" id="text-2-8">
<p>
待续.需要阅读Intel Vol.3A Memory &amp; Cache Control这节.在Intel Vol.1 10.4.6.2也有介绍.
</p>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17"><span class="section-number-3">2.9</span> Alignment</h3>
<div class="outline-text-3" id="text-2-9">
<p>
关于对齐方面,如果使用128bit Memory Operand必须进行16字节的对齐.但是有些例外
</p>
<ul class="org-ul">
<li>使用UnAlign的Data Transfer操作,比如MOVUPS/MOVUPD.</li>
<li>如果是Scalar Memory Float的话,必须是4字节对齐.</li>
<li>如果是Scalar Memory Double的话,必须是8字节对齐.</li>
<li>此外还有部分指令字节对齐存在例外,会在响应的指令部分说明.</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18"><span class="section-number-3">2.10</span> Asymmetric &amp; Horizontal Processing</h3>
<div class="outline-text-3" id="text-2-10">
<p>
分别是对称处理和水平处理.假设存在操作数(a0,a1,a2,a3)以及(b0,b1,b2,b3).
对于大部分SIMD指令处理都是对称处理,也就是(a0 op b0,a1 op b1,a2 op b2,a3 op b3).
相邻处理就是(a0 op a1,a2 op a3,b0 op b1,b2 op b3).
</p>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">2.11</span> Zero Fill &amp; Truncated</h3>
<div class="outline-text-3" id="text-2-11">
<p>
对于从内存/寄存器载入到寄存器的话,如果位数不够,通常是占用寄存器的低字节,
除非显式指定.对于寄存器中没有使用的高字节,通常是采用0填充,也就是Zero Fill.:).
</p>

<p>
而另外一个方面,如果从寄存器传输到内存/寄存器,如果寄存器位数过多的话,那么也
通常只是传输寄存器的低字节,而保留寄存器的高字节,也就是Truncated.:).
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-2">
<h2 id="orgheadline56"><span class="section-number-2">3</span> 指令</h2>
<div class="outline-text-2" id="text-3">
<p>
为了方便表示,我们定义下面缩写和操作.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">助记符</th>
<th scope="col" class="org-left">含义</th>
<th scope="col" class="org-left">其他</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-left">Aligned</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">U</td>
<td class="org-left">UnAligned</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">L</td>
<td class="org-left">Low</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">H</td>
<td class="org-left">High/Horizontal</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">B</td>
<td class="org-left">Byte</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SB</td>
<td class="org-left">Signed Byte</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UB</td>
<td class="org-left">Unsigned Byte</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">W</td>
<td class="org-left">Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SW</td>
<td class="org-left">Signed Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UW</td>
<td class="org-left">Unsigned Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Q</td>
<td class="org-left">Quad Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DQ</td>
<td class="org-left">Double Quad Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">F</td>
<td class="org-left">Float</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">D</td>
<td class="org-left">Double</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PS</td>
<td class="org-left">Packed Single Precision Floating Point</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SS</td>
<td class="org-left">Scalar Single Precision Floating Point</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PD</td>
<td class="org-left">Packed Double Precision Floating Point</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SD</td>
<td class="org-left">Scalar Double Precision Floating Point</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMP</td>
<td class="org-left">Compare</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">STR</td>
<td class="org-left">String</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">EQ</td>
<td class="org-left">Equal</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">GT</td>
<td class="org-left">Greater</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SLL</td>
<td class="org-left">Shift Left Logical</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SRL</td>
<td class="org-left">Shift Right Logical</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SRA</td>
<td class="org-left">Shift Right Arithmetic</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DUP</td>
<td class="org-left">Duplicate</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">WAM</td>
<td class="org-left">Wraparound Mode</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SSM</td>
<td class="org-left">Signed Saturation Mode</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">USM</td>
<td class="org-left">Unsigned Saturation Mode</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RCP</td>
<td class="org-left">Reciprocal.RCP(x)=1/x</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SQRT</td>
<td class="org-left">Square Root</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RSQRT</td>
<td class="org-left">Reciprocal Square Root</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MSK</td>
<td class="org-left">Mask</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVT</td>
<td class="org-left">Convert</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SX</td>
<td class="org-left">Signed Extend</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ZX</td>
<td class="org-left">Zero Extend</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ROUND</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCK</td>
<td class="org-left">Unpack</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">EXTR</td>
<td class="org-left">Extract</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">INSR</td>
<td class="org-left">Insert</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">AND</td>
<td class="org-left">a &amp;&amp; b</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">OR</td>
<td class="org-left">a or b</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">NAND</td>
<td class="org-left">!(a &amp;&amp; b)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">XOR</td>
<td class="org-left">a ^ b</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SAD</td>
<td class="org-left">Sum of Absolute Difference.</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SIGN</td>
<td class="org-left">SIGN(src,dst)=if(src&lt;0):dst=-dst</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MADD</td>
<td class="org-left">MADD((a00,a01),(b00,b01))=(a00*b00)+(a01*b01)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ALIGNR</td>
<td class="org-left">ALIGNR(src,dst,imm)=(src,dst) &gt;&gt; imm</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">AVG</td>
<td class="org-left">Average</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ABS</td>
<td class="org-left">Absolute</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">NT</td>
<td class="org-left">NonTemporal</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTT</td>
<td class="org-left">Convert With Truncate</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCKH</td>
<td class="org-left">UNPCKH((s00,s01),(d00,d01))=(d01,s01)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCKL</td>
<td class="org-left">UNPCKL((s00,s01),(d00,d01))=(d00,s00)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MSB</td>
<td class="org-left">Most Significant Bit</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LF</td>
<td class="org-left">Lowest Float</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LF2</td>
<td class="org-left">Lower 2 Floats</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LF4</td>
<td class="org-left">Lower 4 Floats</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HF</td>
<td class="org-left">Highest Float</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HF2</td>
<td class="org-left">Higher 2 Floats</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LD</td>
<td class="org-left">Lowest Double</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HD</td>
<td class="org-left">Highest Double</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LDW</td>
<td class="org-left">Lower Double Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LDW2</td>
<td class="org-left">Lower 2 Double Words</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LDW4</td>
<td class="org-left">Lower 4 Double Words</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LW</td>
<td class="org-left">Lower Word</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HW</td>
<td class="org-left">Higher Wword</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">GPR</td>
<td class="org-left">General Purpose Resgister</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
这里有几点需要注意的
</p>
<ul class="org-ul">
<li>对于Move如果使用了错误类型指令的话,会产生性能消耗.Vol.1 11.6.9</li>
<li>对于使用SIMD来说,推荐使用caller-save.Vol.1 11.6.10.3</li>
</ul>
</div>

<div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27"><span class="section-number-3">3.1</span> Data Transfer Instructions</h3>
<div class="outline-text-3" id="text-3-1">
</div><div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">3.1.1</span> Move Mask Instructions</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
对于每一个data element的MSB移到GRP.这些指令通常用于分支判定.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PMOVMSKB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVMSKPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVMSKPD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-4">
<h4 id="orgheadline22"><span class="section-number-4">3.1.2</span> Move Integer Instructions</h4>
<div class="outline-text-4" id="text-3-1-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MOVD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVDQA</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVDQU</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">LDDQU</td>
<td class="org-left">功能和MOVDQU相同</td>
</tr>
</tbody>
</table>

<p>
关于LDDQU和MOVDQU的差别,可以参看Intel关于LDDQU指令描述,主要还是在某些场景
下面的性能差别,功能上没有任何区别.
</p>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23"><span class="section-number-4">3.1.3</span> Move Float Instructions</h4>
<div class="outline-text-4" id="text-3-1-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MOVAPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVUPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVLPS</td>
<td class="org-left">2PS&lt;-&gt;LF2(%xmm)</td>
</tr>

<tr>
<td class="org-left">MOVHPS</td>
<td class="org-left">2PS&lt;-&gt;HF2(%xmm)</td>
</tr>

<tr>
<td class="org-left">MOVLHPS</td>
<td class="org-left">LF2(%xmm1)-&gt;HF2(%xmm2)</td>
</tr>

<tr>
<td class="org-left">MOVHLPS</td>
<td class="org-left">HF2(%xmm1)-&gt;LF2(%xmm1)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24"><span class="section-number-4">3.1.4</span> Move Double Instructions</h4>
<div class="outline-text-4" id="text-3-1-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MOVAPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVUPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVSD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVLPD</td>
<td class="org-left">PD&lt;-&gt;LD(%xmm)</td>
</tr>

<tr>
<td class="org-left">MOVHPD</td>
<td class="org-left">PD&lt;-&gt;HD(%xmm)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-4">
<h4 id="orgheadline25"><span class="section-number-4">3.1.5</span> Move Duplication Instructions</h4>
<div class="outline-text-4" id="text-3-1-5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MOVDDUP</td>
<td class="org-left">(d0,d1)-&gt;(d0,d0)</td>
</tr>

<tr>
<td class="org-left">MOVSHDUP</td>
<td class="org-left">(f0,f1,f2,f3)-&gt;(f1,f1,f3,f3)</td>
</tr>

<tr>
<td class="org-left">MOVSLDUP</td>
<td class="org-left">(f0,f1,f2,f3)-&gt;(f0,f0,f2,f2)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">3.1.6</span> Move NonTemporal Instructions</h4>
<div class="outline-text-4" id="text-3-1-6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MOVNTI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVNTQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVNTDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVNTDQA</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVNTPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVNTPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MASKMOVQ</td>
<td class="org-left">@@TODO</td>
</tr>

<tr>
<td class="org-left">MASKMOVDQU</td>
<td class="org-left">@@TODO</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgheadline40" class="outline-3">
<h3 id="orgheadline40"><span class="section-number-3">3.2</span> Arithmetic Instructions</h3>
<div class="outline-text-3" id="text-3-2">
</div><div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="section-number-4">3.2.1</span> ADD Instructions</h4>
<div class="outline-text-4" id="text-3-2-1">
</div><ol class="org-ol"><li><a id="orgheadline28"></a>对称处理<br  /><div class="outline-text-5" id="text-3-2-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PADDB</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PADDW</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PADDD</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PADDQ</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PADDSB</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PADDSW</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PADDUSB</td>
<td class="org-left">USM</td>
</tr>

<tr>
<td class="org-left">PADDUSW</td>
<td class="org-left">USM</td>
</tr>

<tr>
<td class="org-left">ADDPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ADDSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ADDPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ADDSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div></li>

<li><a id="orgheadline29"></a>水平处理<br  /><div class="outline-text-5" id="text-3-2-1-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PHADDW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PHADDSW</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PHADDD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HADDPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HADDPD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div></li></ol>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">3.2.2</span> SUB Instructions</h4>
<div class="outline-text-4" id="text-3-2-2">
</div><ol class="org-ol"><li><a id="orgheadline31"></a>对称处理<br  /><div class="outline-text-5" id="text-3-2-2-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PSUBB</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PSUBW</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PSUBD</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PSUBQ</td>
<td class="org-left">WAM</td>
</tr>

<tr>
<td class="org-left">PSUBSB</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PSUBSW</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PSUBSD</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PSUBUSB</td>
<td class="org-left">USM</td>
</tr>

<tr>
<td class="org-left">PSUBUSW</td>
<td class="org-left">USM</td>
</tr>

<tr>
<td class="org-left">SUBPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SUBSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SUBPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SUBSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div></li>

<li><a id="orgheadline32"></a>水平处理<br  /><div class="outline-text-5" id="text-3-2-2-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PHSUBW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PHSUBSW</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PHSUBD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HSUBPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">HSUBPD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div></li></ol>
</div>

<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34"><span class="section-number-4">3.2.3</span> MUL Instructions</h4>
<div class="outline-text-4" id="text-3-2-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PMULLW</td>
<td class="org-left">(w00,w01,..),(w10,w11,..)-&gt;(LW(w00*w10),LW(w01*w11),..)</td>
</tr>

<tr>
<td class="org-left">PMULHW</td>
<td class="org-left">(w00,w01,..),(w10,w11,..)-&gt;(HW(w00*w10),HW(w01*w11),..)</td>
</tr>

<tr>
<td class="org-left">PMULHUW</td>
<td class="org-left">同上,Unsigned方式.</td>
</tr>

<tr>
<td class="org-left">PMULLD</td>
<td class="org-left">(dw00,dw01,..),(dw10,dw11,..)-&gt;(LDW(dw00*dw10),LDW(dw01*dw11),..)</td>
</tr>

<tr>
<td class="org-left">PMULDQ</td>
<td class="org-left">(dw00,dw01,..),(dw10,dw11,..)-&gt;(dw00*dw10,dw01*dw11,..)</td>
</tr>

<tr>
<td class="org-left">PMULUDQ</td>
<td class="org-left">同上,Unsigned方式.</td>
</tr>

<tr>
<td class="org-left">MULPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MULSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MULPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MULSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">3.2.4</span> DIV Instructions</h4>
<div class="outline-text-4" id="text-3-2-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">DIVPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DIVSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DIVPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DIVSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38"><span class="section-number-4">3.2.5</span> M?X Instructions</h4>
<div class="outline-text-4" id="text-3-2-5">
</div><ol class="org-ol"><li><a id="orgheadline36"></a>MAX<br  /><div class="outline-text-5" id="text-3-2-5-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PMAXSB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMAXSW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMAXSD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMAXUB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMAXUW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMAXUD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MAXPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MAXSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MAXPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MAXSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div></li>

<li><a id="orgheadline37"></a>MIN<br  /><div class="outline-text-5" id="text-3-2-5-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PMINSB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMINSW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMINSD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMINUB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMINUW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMINUD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MINPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MINSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MINPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MINSD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PHMINPOSUW</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
PHMINPOSUW可以按照Unsigned Word来水平搜索最小值的位置.
</p>
</div></li></ol>
</div>

<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><span class="section-number-4">3.2.6</span> Math Instructions</h4>
<div class="outline-text-4" id="text-3-2-6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PABSB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PABSW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PABSD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PAVGB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PAVGW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSIGNB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSIGNW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSIGND</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMADDUBSW</td>
<td class="org-left">UB-&gt;W.SSM</td>
</tr>

<tr>
<td class="org-left">PMADDWD</td>
<td class="org-left">W-&gt;DW</td>
</tr>

<tr>
<td class="org-left">PALIGNR</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMULHRSW</td>
<td class="org-left">@@TODO</td>
</tr>

<tr>
<td class="org-left">PSADBW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MPSADBW</td>
<td class="org-left">@@TODO</td>
</tr>

<tr>
<td class="org-left">DPPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">DPPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ADDSUBPS</td>
<td class="org-left">(f00,f01,..),(f10,f11,..)-&gt;(f00-f10,f01+f11,..)</td>
</tr>

<tr>
<td class="org-left">ADDSUBPD</td>
<td class="org-left">(d00,d01,..),(d10,d11,..)-&gt;(d00-d10,d01+d11,..)</td>
</tr>

<tr>
<td class="org-left">RCPPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RCPSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RSQRTPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">RSQRTSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SQRTPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SQRTSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SQRTSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgheadline41" class="outline-3">
<h3 id="orgheadline41"><span class="section-number-3">3.3</span> Comparison Instructions</h3>
<div class="outline-text-3" id="text-3-3">
<p>
需要注意的是,如果没有特殊说明,比较结果是直接存放在结果数里面的,
不会影响EFLAGS这个寄存器内容.如果比较结果影响了EFLAGS寄存器的话,
那么会使用%EFLAGS来标记.
</p>

<p>
如果每个比较结果是符合预期的话,
那么目的数对应位数会置0xff,否则会置0x0.
</p>

<p>
对于CMP的指令,会使用立即数来决定具体使用什么比较方式.关于立即数对应
什么比较方式,可以查看具体指令里面的说明,比如CMPPS,CMPSS,CMPPD,CMPSD.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PCMPEQB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPEQW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPEQD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPEQQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPGTB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPGTW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPGTD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPGTQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMPPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMPSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMPPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CMPSD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">COMISS</td>
<td class="org-left">%EFLAGS</td>
</tr>

<tr>
<td class="org-left">UCOMISS</td>
<td class="org-left">%EFLAGS</td>
</tr>

<tr>
<td class="org-left">COMISD</td>
<td class="org-left">%EFLAGS</td>
</tr>

<tr>
<td class="org-left">UCOMISD</td>
<td class="org-left">%EFLAGS</td>
</tr>

<tr>
<td class="org-left">PTEST</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-3">
<h3 id="orgheadline42"><span class="section-number-3">3.4</span> Conversion Instructions</h3>
<div class="outline-text-3" id="text-3-4">
<p>
对于涉及到浮点数的精度取舍问题,使用%mxccsr寄存器来判断.
</p>

<p>
如果精度取舍是采用截断方式来进行处理的话,那么指令前缀通常是CVTT.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PACKSSWB</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PACKSSDW</td>
<td class="org-left">SSM</td>
</tr>

<tr>
<td class="org-left">PACKUSDW</td>
<td class="org-left">USM</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">CVTPS2PD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPD2PS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTSS2SD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTSD2SS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPI2PS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPS2PI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTTPS2PI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTSI2SS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTSS2SI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTTSS2SI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPI2PD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPD2PI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTTPD2PI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTSI2SD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTSD2SI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTTSD2SI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTDQ2PS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPS2DQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTTPS2DQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTDQ2PD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTPD2DQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">CVTTPD2DQ</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">MOVQ2DQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">MOVDQ2Q</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVSXBW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVZXBW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVSXBD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVZXBD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVSXWD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVZXWD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVSXBQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVZXBQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVSXWQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVZXWQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVSXDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PMOVZXDQ</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ROUNDPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ROUNDPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ROUNDSS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ROUNDSD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-3">
<h3 id="orgheadline43"><span class="section-number-3">3.5</span> Insert &amp; Unpack Instructions</h3>
<div class="outline-text-3" id="text-3-5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PUNPCKHBW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKHWD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKHDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKHQDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKLBW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKLWD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKLDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PUNPCKLQDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCKHPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCKLPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCKHPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">UNPCKLPD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PEXTRB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PEXTRW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PEXTRD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PEXTRQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PINSRB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PINSRW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PINSRD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PINSRQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">EXTRACTPS</td>
<td class="org-left">-&gt;GPR</td>
</tr>

<tr>
<td class="org-left">INSERTPS</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-3">
<h3 id="orgheadline44"><span class="section-number-3">3.6</span> Logical Instructions</h3>
<div class="outline-text-3" id="text-3-6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PAND</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PANDN</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">POR</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PXOR</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ANDPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ANDNPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ORPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">XORPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ANDPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ANDNPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">ORPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">XORPD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-3">
<h3 id="orgheadline45"><span class="section-number-3">3.7</span> Shift Instructions</h3>
<div class="outline-text-3" id="text-3-7">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PSLLW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSLLD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSLLQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSLLDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSRLW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSRLD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSRLQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSRLDQ</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSRAW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSRAD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-3">
<h3 id="orgheadline46"><span class="section-number-3">3.8</span> Shuffle Instructions</h3>
<div class="outline-text-3" id="text-3-8">
<p>
SHUF操作根据imm来决定,dst每个位置的element应该是由
src的哪个位置的element来进行填充的.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PSHUFB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSHUFW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSHUFLW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSHUFHW</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PSHUFD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SHUFPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">SHUFPD</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47"><span class="section-number-3">3.9</span> Blending Instructions</h3>
<div class="outline-text-3" id="text-3-9">
<p>
BLEND操作是根据imm来决定,dst每个位置的element应该是从src里面对应位置取出,
还是应该从dst里面对应位置取出.
</p>

<p>
BLENDV操作和BLEND操作过程一样的,不同的是由%xmm0来决定的而不是由imm来决定.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">BLENDPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">BLENDPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">BLENDVPS</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">BLENDVPD</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PBLENDVB</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PBLENDW</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-3">
<h3 id="orgheadline48"><span class="section-number-3">3.10</span> String Instructions</h3>
<div class="outline-text-3" id="text-3-10">
<ul class="org-ul">
<li>内存操作数不要求字节对齐.</li>
<li>CMPE/I的E表示explicit显式指定长度,I表示implicit隐式指定长度.</li>
<li>STRI/STRM的I表示结果是Index,M表示结果是Mask.</li>
</ul>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">指令</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">PCMPESTRI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPESTRM</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPISTRI</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">PCMPISTRM</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-3">
<h3 id="orgheadline55"><span class="section-number-3">3.11</span> MISC Instructions</h3>
<div class="outline-text-3" id="text-3-11">
</div><div id="outline-container-orgheadline49" class="outline-4">
<h4 id="orgheadline49"><span class="section-number-4">3.11.1</span> Cache Control Instructions</h4>
<div class="outline-text-4" id="text-3-11-1">
<ul class="org-ul">
<li>CLFLUSH</li>
</ul>
<p>
CLFLUSH是cache line flush,能够将某个内存地址的cache line全部失效.
</p>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50"><span class="section-number-4">3.11.2</span> Prefetch Instructions</h4>
<div class="outline-text-4" id="text-3-11-2">
<p>
对于预取指令的话不会影响程序行为,通常来说会预取32个对齐的字节,但是具体
还是依赖于实现.对于NT数据的话,依然会尽可能地减少Cache的污染.
</p>

<ul class="org-ul">
<li>PREFETCH0</li>
</ul>
<p>
预取到所有Cache层次.
</p>
<ul class="org-ul">
<li>PREFETCH1</li>
</ul>
<p>
预取到1级缓存.
</p>
<ul class="org-ul">
<li>PREFETCH2</li>
</ul>
<p>
预取到2级缓存.
</p>
<ul class="org-ul">
<li>PREFETCHNTA</li>
</ul>
<p>
???
</p>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-4">
<h4 id="orgheadline51"><span class="section-number-4">3.11.3</span> Memory Ordering Instructions</h4>
<div class="outline-text-4" id="text-3-11-3">
<ul class="org-ul">
<li>SFENCE</li>
</ul>
<p>
在SFENCE之前的Store操作,从全局视图来看,一定在SFENCE之后的Store操作之前完成.
</p>
<ul class="org-ul">
<li>LFENCE</li>
</ul>
<p>
在LFENCE之前的Load操作,从全局视图来看,一定在LFENCE之后的Load操作之前完成.
</p>
<ul class="org-ul">
<li>MFENCE</li>
</ul>
<p>
MFENCE结合了SFENCE和LFENCE两个功能.
</p>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-4">
<h4 id="orgheadline52"><span class="section-number-4">3.11.4</span> X87 FPU Instructions</h4>
<div class="outline-text-4" id="text-3-11-4">
<ul class="org-ul">
<li>FISTTP</li>
</ul>
<p>
这条指令非常类似FISTP,是将FPU TOS的浮点数转换成为整数,精度处理使用截断.
FISTP需要修改FPU Tag Word设置为截断处理才会有这样的效果,
</p>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-4">
<h4 id="orgheadline53"><span class="section-number-4">3.11.5</span> Thread Sync Instructions</h4>
<div class="outline-text-4" id="text-3-11-5">
<p>
需要注意的是,这些指令都只能够在ring0级别下面运行,对于&lt;ring0的界别是可选运行的.
</p>
<ul class="org-ul">
<li>MONITOR</li>
</ul>
<p>
设置一块地址区域来监视是否存在write-back-stores的操作.
</p>
<ul class="org-ul">
<li>MWAIT</li>
</ul>
<p>
等待某块地址区域发生write-back-stores.这块地址区域必须经过MONITOR设置.在等待
这块地址区域写入的时候Logical Processor能够进入optimized state.
</p>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="section-number-4">3.11.6</span> 其他</h4>
<div class="outline-text-4" id="text-3-11-6">
<ul class="org-ul">
<li>PAUSE</li>
</ul>
<p>
PAUSE指令能够显著改善自旋锁的循环等待期间的性能,同时减少机器的耗能.
</p>
<ul class="org-ul">
<li>Branch Hints</li>
</ul>
<p>
对于Jcc这样的指令,允许在之前加上2EH,3EH作为Prefix能够进行预取提示.
这个没有特别的助记符,只是在生成的机器代码二进制上略有不同.
</p>
<ul class="org-ul">
<li>CRC32</li>
</ul>
<p>
CRC32算法的有效实现.
</p>
<ul class="org-ul">
<li>POPCNT</li>
</ul>
<p>
计算操作数的bit表示中存在多少个1.
</p>
</div>
</div>
</div>
</div>
</div>
<!-- DISQUS BEGIN --><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * *//* required: replace example with your forum shortname  */var disqus_shortname = 'dirlt';var disqus_identifier = 'simd.html';var disqus_title = 'simd.html';var disqus_url = 'http://dirtysalt.github.io/simd.html';/* * * DON'T EDIT BELOW THIS LINE * * */(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><!-- DISQUS END --></body>
</html>
